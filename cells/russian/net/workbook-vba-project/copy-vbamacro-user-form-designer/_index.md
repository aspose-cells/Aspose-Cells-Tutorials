---
"description": "Узнайте, как эффективно копировать VBA Macro User Form Designer в Aspose.Cells для .NET с помощью нашего комплексного пошагового руководства! Раскройте потенциал Excel."
"linktitle": "Копировать хранилище конструктора пользовательских форм VBAMacro в рабочую книгу с помощью Aspose.Cells"
"second_title": "API обработки Excel Aspose.Cells .NET"
"title": "Копировать хранилище конструктора пользовательских форм VBAMacro в рабочую книгу с помощью Aspose.Cells"
"url": "/ru/net/workbook-vba-project/copy-vbamacro-user-form-designer/"
"weight": 11
---

{{< blocks/products/pf/main-wrap-class >}}

{{< blocks/products/pf/main-container >}}

{{< blocks/products/pf/tutorial-page-section >}}

# Копировать хранилище конструктора пользовательских форм VBAMacro в рабочую книгу с помощью Aspose.Cells

## Введение
Добро пожаловать! Если вы хотите улучшить свой опыт работы с Excel с помощью макросов VBA и пользовательских форм, вы попали по адресу! В этом руководстве мы подробно рассмотрим, как можно легко скопировать конструктор пользовательских форм VBA Macro из одной книги в другую с помощью Aspose.Cells для .NET. Независимо от того, являетесь ли вы опытным разработчиком или только начинаете, мы проведем вас через каждый важный шаг. Считайте это своим руководством по освоению искусства программной обработки файлов Excel. Готовы погрузиться? Поехали!
## Предпосылки
Прежде чем мы перейдем к тонкостям кодирования, давайте убедимся, что у вас есть все необходимое:
1. Среда разработки C#: У вас должна быть рабочая среда, готовая к разработке C#. Настоятельно рекомендуется Visual Studio.
2. Библиотека Aspose.Cells для .NET: Убедитесь, что библиотека Aspose.Cells интегрирована в ваш проект. Вы можете легко [скачать здесь](https://releases.aspose.com/cells/net/).
3. Базовые знания VBA и макросов Excel: хорошее понимание VBA и принципов работы макросов Excel поможет вам легко ориентироваться в этом руководстве.
4. Файл Excel с формой пользователя: для экспериментов создайте или получите книгу Excel, содержащую форму пользователя, желательно с включенными макросами (например, `.xlsm` файлы).
## Импортные пакеты
В вашем проекте C# вам нужно будет импортировать определенные пространства имен в верхней части файла, чтобы использовать функциональные возможности Aspose.Cells. Вот как это сделать:
```csharp
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Aspose.Cells.Vba;
```
Включение этих пространств имен позволяет получить доступ ко всем мощным инструментам, встроенным в библиотеку Aspose.Cells. 
Теперь, когда у нас есть все необходимые условия и пакеты, пора переходить к самой интересной части: кодированию! Давайте разберем все пошагово.
## Шаг 1: Определите исходные и выходные каталоги
Сначала вам необходимо определить, где находятся ваши файлы:
```csharp
// Исходный каталог
string sourceDir = "Your Document Directory";
// Выходной каталог
string outputDir = "Your Document Directory";
```
Здесь замените `"Your Document Directory"` с фактическим путем, где хранятся ваши файлы. Это то, откуда будет взята наша исходная рабочая книга (с UserForm) и где будет сохранена новая рабочая книга.
## Шаг 2: Создайте пустую целевую рабочую книгу
Далее давайте создадим нашу целевую книгу, в которую мы будем копировать нашу пользовательскую форму и макросы:
```csharp
// Создать пустую целевую книгу
Workbook target = new Workbook();
```
Эта строка кода инициализирует новую пустую книгу для заполнения данными. Думайте об этом как о чистом холсте для вашего шедевра!
## Шаг 3: Загрузите шаблон рабочей книги
Нам нужно загрузить рабочую книгу, содержащую вашу пользовательскую форму и макросы:
```csharp
// Загрузите файл Excel, содержащий форму пользователя VBA-Macro Designer
Workbook templateFile = new Workbook(sourceDir + "sampleDesignerForm.xlsm");
```
Обязательно измените `"sampleDesignerForm.xlsm"` на имя вашего фактического файла. Эта рабочая книга — как ваша книга рецептов — из нее мы будем черпать ингредиенты!
## Шаг 4: Копирование рабочих листов в целевую рабочую книгу
Теперь давайте начнем копировать рабочие листы из нашего шаблона в целевую рабочую книгу:
```csharp
// Копировать все шаблоны рабочих листов в целевую рабочую книгу
foreach (Worksheet ws in templateFile.Worksheets)
{
    if (ws.Type == SheetType.Worksheet)
    {
        Worksheet s = target.Worksheets.Add(ws.Name);
        s.Copy(ws);
        // Поместите сообщение в ячейку A2 целевого рабочего листа.
        s.Cells["A2"].PutValue("VBA Macro and User Form copied from template to target.");
    }
}
```
На этом этапе мы проходим по каждому рабочему листу в шаблоне и копируем их в нашу целевую рабочую книгу. Если задуматься, это похоже на перенос ваших лучших рецептов из одной кулинарной книги в другую!
## Шаг 5: Скопируйте макросы VBA из шаблона
Далее мы скопируем макросы VBA, включая модули UserForm Designer, в нашу новую рабочую книгу:
```csharp
// Копировать пользовательскую форму VBA-Macro Designer из шаблона в целевой объект
foreach (VbaModule vbaItem in templateFile.VbaProject.Modules)
{
    if (vbaItem.Name == "ThisWorkbook")
    {
        // Скопировать код модуля ThisWorkbook
        target.VbaProject.Modules["ThisWorkbook"].Codes = vbaItem.Codes;
    }
    else
    {
        // Копировать код и данные других модулей
        System.Diagnostics.Debug.Print(vbaItem.Name);
        int vbaMod = 0;
        Worksheet sheet = target.Worksheets.GetSheetByCodeName(vbaItem.Name);
        if (sheet == null)
        {
            vbaMod = target.VbaProject.Modules.Add(vbaItem.Type, vbaItem.Name);
        }
        else
        {
            vbaMod = target.VbaProject.Modules.Add(sheet);
        }
        target.VbaProject.Modules[vbaMod].Codes = vbaItem.Codes;
        if ((vbaItem.Type == VbaModuleType.Designer))
        {
            // Получить данные пользовательской формы, т.е. хранилище дизайнера
            byte[] designerStorage = templateFile.VbaProject.Modules.GetDesignerStorage(vbaItem.Name);
            // Добавьте хранилище конструктора в целевой проект Vba
            target.VbaProject.Modules.AddDesignerStorage(vbaItem.Name, designerStorage);
        }
    }
}
```
Этот здоровенный кусок кода обрабатывает проверку каждого модуля VBA в файле шаблона. Мы копируем дизайн UserForm и связанные с ним коды. Это как гарантировать, что вы получите не только знаменитый рецепт бабушкиного пирога, но и ее точные методы выпечки!
## Шаг 6: Сохраните целевую рабочую книгу
После того, как мы сделаем все копии, настанет время сохранить результаты нашей тяжелой работы:
```csharp
// Сохраните целевую рабочую книгу
target.Save(outputDir + "outputDesignerForm.xlsm", SaveFormat.Xlsm);
```
Обязательно измените имя выходного файла по мере необходимости. После сохранения вы фактически создаете свою собственную версию рабочей книги, наполненную макросами и пользовательскими формами. Насколько это волнительно?
## Шаг 7: Подтвердите успех
Наконец, выведем на консоль сообщение об успешном завершении:
```csharp
Console.WriteLine("CopyVBAMacroUserFormDesignerStorageToWorkbook executed successfully.\r\n");
```
Эта маленькая строчка уверяет вас, что ваш процесс прошел гладко. Это вишенка на торте вашего кодирования!
## Заключение
Поздравляем! Вы завершили пошаговое руководство по копированию конструктора пользовательских форм макросов VBA из одной рабочей книги в другую с помощью Aspose.Cells для .NET. Сначала это может показаться немного сложным, но с практикой вы будете справляться с манипуляциями с рабочей книгой как профессионал. Помните, что кодирование — это практика, поэтому не бойтесь пробовать разные вещи в своих файлах Excel. Если у вас есть какие-либо вопросы или вы столкнулись с какими-либо проблемами, не стесняйтесь заглянуть на форумы Aspose или в документацию для получения поддержки!
## Часто задаваемые вопросы
### Какие версии Excel поддерживает Aspose.Cells?
Aspose.Cells поддерживает широкий спектр форматов Excel, включая XLSX, XLSM, CSV и другие.
### Могу ли я использовать Aspose.Cells бесплатно?
Да! Вы можете начать с бесплатной пробной версии, которая позволит вам оценить библиотеку: [Бесплатная пробная версия](https://releases.aspose.com/).
### Нужна ли мне Visual Studio для запуска этого кода?
Хотя его настоятельно рекомендуют из-за удобных для пользователя функций, подойдет любая среда C# IDE, если она поддерживает разработку .NET.
### Где я могу найти больше примеров и документации?
Вы можете исследовать [Документация Aspose.Cells](https://reference.aspose.com/cells/net/) для получения дополнительных примеров и подробных объяснений.
### Как решить проблемы при использовании Aspose.Cells?
Вам следует посетить [Форум поддержки Aspose](https://forum.aspose.com/c/cells/9) за помощь от сообщества и службы поддержки Aspose.

{{< /blocks/products/pf/tutorial-page-section >}}

{{< /blocks/products/pf/main-container >}}

{{< /blocks/products/pf/main-wrap-class >}}

{{< blocks/products/products-backtop-button >}}