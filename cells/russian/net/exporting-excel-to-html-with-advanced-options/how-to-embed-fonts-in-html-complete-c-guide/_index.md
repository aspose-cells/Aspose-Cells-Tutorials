---
category: general
date: 2026-01-14
description: Как внедрить шрифты в HTML и принудительно выполнять расчёт формул при
  конвертации Excel в HTML. Узнайте, как задать область печати и экспортировать диаграммы.
draft: false
keywords:
- how to embed fonts
- embed fonts in html
- force formula calculation
- convert excel to html
- how to set print area
language: ru
og_description: Как внедрить шрифты в HTML, принудительно выполнить расчёт формул
  и преобразовать Excel в HTML с настройками области печати — всё на C#.
og_title: Как внедрить шрифты в HTML – Полное руководство по C#
tags:
- Aspose.Cells
- C#
- Excel Automation
title: Как внедрить шрифты в HTML – полное руководство по C#
url: /ru/net/exporting-excel-to-html-with-advanced-options/how-to-embed-fonts-in-html-complete-c-guide/
---

{{< blocks/products/pf/main-wrap-class >}}
{{< blocks/products/pf/main-container >}}
{{< blocks/products/pf/tutorial-page-section >}}

# Как встроить шрифты в HTML – Полное руководство на C#

Когда‑то задумывались **как встроить шрифты в HTML** при экспорте книги Excel? Вы не одиноки. Многие разработчики сталкиваются с тем, что сгенерированный HTML выглядит отлично на их машине, но теряет типографику на другом устройстве. Хорошая новость? С Aspose.Cells for .NET вы можете встроить точные файлы шрифтов прямо в HTML‑вывод — никаких недостающих глифов.

В этом руководстве мы пройдем полный пример, который не только показывает **как встроить шрифты в HTML**, но и демонстрирует **принудительный расчёт формул**, **конвертацию Excel в HTML**, а также **как задать область печати** перед экспортом диаграммы в редактируемый PPTX. К концу вы получите один исполняемый C#‑программный файл, который можно добавить в любой .NET‑проект.

---

## Что вы создадите

- Создадите новую книгу, запишете пару массивных формул и **принудительно рассчитаете формулы**, чтобы результаты были зафиксированы в файле.
- Сохраните книгу как HTML, **встраивая шрифты** и их селекторы вариаций.
- Загрузите вторую книгу, содержащую диаграмму, задайте **область печати** и экспортируйте лист в редактируемую презентацию PowerPoint.
- Всё это с помощью нескольких строк чистого, хорошо прокомментированного C#‑кода.

Никаких внешних инструментов, никаких ручных копирований файлов шрифтов — Aspose.Cells делает всю тяжелую работу за вас.

---

## Предварительные требования

| Требование | Причина |
|-------------|--------|
| .NET 6.0 или новее | Современные возможности языка и лучшая производительность |
| Aspose.Cells for .NET (NuGet‑пакет `Aspose.Cells`) | Предоставляет `Workbook`, `HtmlSaveOptions`, `ImageOrPrintOptions` и т.д. |
| Пара файлов TrueType/OpenType (например, `Arial.ttf`), размещённых в папке проекта | Необходимы для встраивания; Aspose автоматически их найдёт, если они установлены в ОС |
| Базовые знания C# | Чтобы понять код и адаптировать его под свои сценарии |

---

## Шаг 1 – Создание книги и запись массивных формул  

Сначала создаём новый экземпляр `Workbook` и помещаем две массивные формулы в ячейки **A1** и **A3**. Эти формулы (`WRAPCOLS` и `WRAPROWS`) создают небольшой массив 2 × 2, который позже будет отображён в HTML‑выводе.

```csharp
using Aspose.Cells;

namespace FontEmbeddingDemo
{
    class Program
    {
        static void Main()
        {
            // Step 1: Create a new workbook and get the first worksheet
            Workbook workbook = new Workbook();
            Worksheet worksheet = workbook.Worksheets[0];

            // Write WRAPCOLS formula – returns a 2‑column array
            worksheet.Cells[0, 0].Formula = "=WRAPCOLS({1,2,3,4},2)";

            // Write WRAPROWS formula – returns a 2‑row array
            worksheet.Cells[2, 0].Formula = "=WRAPROWS({1;2;3;4},2)";
```

> **Почему это важно:** Вставляя формулы, вы получаете динамическое содержимое, которое будет вычислено, когда мы позже принудительно рассчитаем их. Это также показывает, что экспорт в HTML корректно обрабатывает результаты массивов.

---

## Шаг 2 – Принудительный расчёт формул  

Aspose.Cells лениво вычисляет формулы. Чтобы гарантировать, что наш HTML содержит рассчитанные значения (а не сырые формулы), вызываем `CalculateFormula()`.

```csharp
            // Step 2: Force calculation so the formulas are evaluated
            worksheet.CalculateFormula();
```

> **Совет:** Если пропустить этот шаг, в HTML будет отображён текст формулы (`=WRAPCOLS...`) вместо чисел, что разрушает цель polished‑экспорта.

---

## Шаг 3 – Настройка параметров сохранения HTML для встраивания шрифтов  

Теперь главный момент: встраивание шрифтов. Установка `EmbedFonts` в `true` заставляет Aspose включать данные шрифтов в виде Base64‑закодированных потоков внутри генерируемого HTML‑файла. Включение `EmbedFontVariationSelectors` гарантирует, что любые селекторы вариаций OpenType (используемые для продвинутой типографии) также сохраняются.

```csharp
            // Step 3: Prepare HTML save options that embed fonts and their variation selectors
            HtmlSaveOptions htmlSaveOptions = new HtmlSaveOptions
            {
                EmbedFonts = true,
                EmbedFontVariationSelectors = true
            };
```

> **Как это работает:** При записи HTML Aspose вставляет блок `<style>` с правилами `@font-face`, которые ссылаются на встроенные data‑URI. Браузеры отобразят точно такой же шрифт, независимо от установленных у клиента шрифтов.

---

## Шаг 4 – Сохранение книги как HTML  

Сначала сохраняем книгу в файл `.xlsx` (на случай, если понадобится исходник), а затем экспортируем её в HTML, используя только что настроенные параметры.

```csharp
            // Step 4: Save the workbook as HTML using the configured options
            string outputDir = @"C:\Demo\Output\"; // adjust to your environment
            workbook.Save(Path.Combine(outputDir, "fontDemo.xlsx"));
            workbook.Save(Path.Combine(outputDir, "fontDemo.html"), htmlSaveOptions);
```

> **Результат:** Откройте `fontDemo.html` в любом современном браузере, и вы увидите массивные значения, отрисованные встроенным шрифтом, даже если шрифт не установлен на вашей машине.

---

## Шаг 5 – Загрузка книги с диаграммой и задание области печати  

Далее демонстрируем **как задать область печати** перед экспортом листа, содержащего диаграмму. Область печати ограничивает то, что будет отрисовано, что удобно, когда нужен только определённый диапазон в итоговом PPTX.

```csharp
            // Step 5: Load a workbook that contains a chart and configure PPTX export options
            Workbook chartWorkbook = new Workbook(Path.Combine(outputDir, "chartEditable.xlsx"));

            // Define the print area (e.g., A1:G20) – this is the SECONDARY keyword in action
            chartWorkbook.Worksheets[0].PageSetup.PrintArea = "A1:G20";
```

> **Зачем задавать область печати?** Без неё Aspose экспортирует весь лист, включая пустые строки/столбцы, что увеличивает размер PPTX.

---

## Шаг 6 – Экспорт листа в редактируемый PPTX  

Наконец, экспортируем лист в редактируемый файл PowerPoint. Установив `ExportChartAsEditable = true`, диаграмма сохраняется как нативные объекты PowerPoint, позволяя конечным пользователям изменять её напрямую в PowerPoint.

```csharp
            // Step 6: Configure PPTX export options
            ImageOrPrintOptions pptSaveOptions = new ImageOrPrintOptions
            {
                SaveFormat = SaveFormat.Pptx,
                ExportChartAsEditable = true
            };

            // Step 7: Save as editable PPTX
            chartWorkbook.Save(Path.Combine(outputDir, "editableChart.pptx"), pptSaveOptions);
        }
    }
}
```

> **Что вы получаете:** `editableChart.pptx` содержит диаграмму из `chartEditable.xlsx` как редактируемые объекты PowerPoint, ограниченные диапазоном `A1:G20`.

---

## Обзор ожидаемых файлов  

| Файл | Описание |
|------|----------|
| `fontDemo.xlsx` | Исходная книга с рассчитанными массивными формулами. |
| `fontDemo.html` | HTML‑файл, **встраивающий шрифты**, показывающий массивные результаты и работающий офлайн. |
| `editableChart.pptx` | Презентация PowerPoint с редактируемой диаграммой, учитывающая **область печати**, которую вы задали. |

Откройте `fontDemo.html` в Chrome или Edge; вы заметите, что текст использует именно тот шрифт, который вы встроили (например, Arial), даже если система его не имеет. Диаграмму в `editableChart.pptx` можно двойным щелчком открыть и редактировать как любую нативную диаграмму PowerPoint.

---

## Часто задаваемые вопросы и особые случаи  

### Что если шрифт не установлен на сервере?  
Aspose.Cells встроит только те шрифты, которые *доступны* во время выполнения. Если конкретный файл шрифта отсутствует, HTML перейдёт к шрифту по умолчанию браузера. Чтобы гарантировать встраивание, скопируйте необходимые файлы `.ttf`/`.otf` в папку приложения и укажите их через `FontInfo` (расширенный сценарий).

### Можно ли встроить только подмножество символов, чтобы уменьшить размер файла?  
Да. Используйте `HtmlSaveOptions.FontEmbeddingMode = FontEmbeddingMode.Subset`. Это заставит Aspose включать только глифы, реально использованные в книге, существенно уменьшая размер HTML‑payload.

### Работает ли **принудительный расчёт формул** для волатильных функций, таких как `NOW()`?  
Абсолютно. `CalculateFormula()` вычисляет все формулы, включая волатильные, в момент вызова. Если нужно, чтобы расчёт отражал определённую дату/время, задайте `CalculationOptions` книги заранее.

### Что происходит с большими книгами — не раздует ли встраивание шрифтов HTML?  
Встраивание шрифтов добавляет примерно 100‑200 KB на каждый шрифт (в зависимости от размера). Для массивных отчётов рассмотрите возможность ссылки на веб‑хостed шрифты вместо встраивания, либо используйте режим подмножества, упомянутый выше.

---

## Профессиональные советы и лучшие практики  

- **Пакетные сохранения:** При генерации десятков HTML‑файлов переиспользуйте один экземпляр `HtmlSaveOptions`, чтобы избежать лишних аллокаций.  
- **Кеширование областей печати:** При экспорте множества листов храните желаемую область печати в конфигурационном файле, чтобы код оставался DRY.  
- **Проверка вывода:** После сохранения HTML запустите быстрый headless‑браузерный чек (например, Puppeteer), чтобы убедиться, что шрифты отображаются корректно перед отправкой пользователям.  
- **Фиксация версии:** Приведённый код рассчитан на Aspose.Cells 23.12+. Более новые версии могут добавить дополнительные опции, такие как `FontEmbeddingMode`. Всегда проверяйте примечания к релизу.

---

## Заключение  

Мы рассмотрели **как встроить шрифты в HTML** с помощью Aspose.Cells, показали важность **принудительного расчёта формул**, продемонстрировали чистый **рабочий процесс конвертации Excel в HTML** и объяснили **как задать область печати** перед экспортом диаграммы в редактируемый PPTX. Полный, готовый к запуску пример находится в одном файле `Program.cs`, так что вы можете скопировать‑вставить, изменить пути и запустить его уже сегодня.

Готовы к следующему шагу? Попробуйте заменить встроенный шрифт на фирменный типографический шрифт или поэкспериментировать с режимом `Subset`, чтобы ваш HTML оставался лёгким. Та же схема работает для PDF, изображений и даже CSV‑экспорта — просто поменяйте класс `SaveOptions`.

Есть вопросы о встраивании шрифтов, работе с формулами или трюках с областью печати? Оставляйте комментарий ниже или пишите в форумы сообщества Aspose. Happy coding!

{{< /blocks/products/pf/tutorial-page-section >}}
{{< /blocks/products/pf/main-container >}}
{{< /blocks/products/pf/main-wrap-class >}}
{{< blocks/products/products-backtop-button >}}