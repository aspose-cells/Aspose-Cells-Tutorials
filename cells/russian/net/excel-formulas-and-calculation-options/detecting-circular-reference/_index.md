---
title: Программное обнаружение циклических ссылок в Excel
linktitle: Программное обнаружение циклических ссылок в Excel
second_title: API обработки Excel Aspose.Cells .NET
description: Легко обнаруживайте циклические ссылки в Excel с помощью Aspose.Cells для .NET. Следуйте нашему пошаговому руководству, чтобы обеспечить точность расчетов в ваших электронных таблицах.
weight: 13
url: /ru/net/excel-formulas-and-calculation-options/detecting-circular-reference/
---

{{< blocks/products/pf/main-wrap-class >}}
{{< blocks/products/pf/main-container >}}
{{< blocks/products/pf/tutorial-page-section >}}

# Программное обнаружение циклических ссылок в Excel

## Введение
Когда дело доходит до работы с файлами Excel, одной из самых неприятных проблем, с которой вы можете столкнуться, является циклическая ссылка. Это происходит, когда формула ссылается обратно на свою собственную ячейку, напрямую или косвенно, создавая цикл, который может сбить с толку вычислительный механизм Excel. Но не бойтесь! С Aspose.Cells для .NET вы можете программно обнаружить эти надоедливые циклические ссылки, гарантируя, что ваши электронные таблицы останутся функциональными и точными. В этом руководстве мы проведем вас через этот процесс шаг за шагом, сделав его максимально простым.
## Предпосылки
Прежде чем мы углубимся в детали обнаружения циклических ссылок, давайте убедимся, что у вас есть все необходимое для начала работы:
1. Visual Studio: Убедитесь, что на вашем компьютере установлена Visual Studio. Это будет ваша среда разработки.
2. .NET Framework: убедитесь, что вы используете совместимую версию .NET Framework (как минимум .NET Framework 4.0).
3.  Библиотека Aspose.Cells: Вам нужна библиотека Aspose.Cells. Вы можете загрузить ее с[Сайт Aspose](https://releases.aspose.com/cells/net/).
4. Базовые знания C#: знакомство с программированием на C# будет преимуществом, поскольку мы будем писать код на этом языке.
5. Файл Excel: Подготовьте файл Excel, содержащий циклические ссылки для тестирования. Вы можете создать простой файл или загрузить образец.
Теперь, когда у нас есть все необходимые условия, давайте перейдем к самой интересной части!
## Импортные пакеты
Прежде чем начать кодирование, вам нужно импортировать необходимые пакеты. Вот как это сделать:
### Создать новый проект
- Откройте Visual Studio и создайте новый проект консольного приложения C#.
### Добавить ссылку Aspose.Cells
- Щелкните правой кнопкой мыши по вашему проекту в обозревателе решений.
- Выберите «Управление пакетами NuGet».
- Найдите «Aspose.Cells» и установите последнюю версию.
### Импорт требуемых пространств имен
 В верхней части вашего`Program.cs` файл, импортируйте необходимые пространства имен:
```csharp
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;
```

Теперь, когда у нас все настроено, давайте перейдем к коду для обнаружения циклических ссылок в файле Excel.
## Шаг 1: Определите входной каталог
Сначала вам нужно указать каталог, в котором находится ваш файл Excel. Это то место, куда вы загрузите свой файл Excel.
```csharp
// Входной каталог
string sourceDir = "Your Document Directory";
```
 Заменять`"Your Document Directory"` с фактическим путем к вашему файлу Excel.
## Шаг 2: Загрузите рабочую книгу с помощью LoadOptions
Далее вы загрузите свою книгу Excel. Вот тут-то и начинается волшебство!
```csharp
LoadOptions loadOptions = new LoadOptions();
var objWB = new Aspose.Cells.Workbook(sourceDir + "Circular Formulas.xls", loadOptions);
```
 Здесь мы создаем новый экземпляр`LoadOptions` и загрузка рабочей книги из указанного пути. Убедитесь, что имя вашего файла Excel совпадает!
## Шаг 3: Включите параметры итерации
Чтобы разрешить циклические ссылки, необходимо включить параметры итерации в рабочей книге.
```csharp
objWB.Settings.Iteration = true;
```
Это сообщает Aspose.Cells о необходимости разрешить циклические ссылки во время вычислений.
## Шаг 4: Создание параметров расчета и кругового монитора
Теперь давайте создадим параметры расчета и наш собственный круглый монитор.
```csharp
CalculationOptions copts = new CalculationOptions();
CircularMonitor cm = new CircularMonitor();
copts.CalculationMonitor = cm;
```
 Здесь мы создаем экземпляр`CalculationOptions` и обычай`CircularMonitor`Этот монитор поможет отслеживать любые циклические ссылки, обнаруженные во время вычислений.
## Шаг 5: Рассчитайте формулы
Теперь пришло время вычислить формулы в вашей рабочей тетради.
```csharp
objWB.CalculateFormula(copts);
```
Эта строка выполняет расчет и проверяет наличие циклических ссылок.
## Шаг 6: Подсчет циклических ссылок
После расчета можно подсчитать, сколько циклических ссылок было найдено.
```csharp
long lngCircularRef = cm.circulars.Count;
Console.WriteLine("Circular References found - " + lngCircularRef);
```
Это выведет количество циклических ссылок, обнаруженных в вашем файле Excel.
## Шаг 7: Отображение результатов
Наконец, давайте отобразим результаты и убедимся, что наш метод выполнился успешно.
```csharp
Console.WriteLine("DetectCircularReference executed successfully.\r\n");
```
## Шаг 8: Реализация класса CircularMonitor
 Для завершения процесса вам необходимо реализовать`CircularMonitor` класс. Этот класс будет наследовать от`AbstractCalculationMonitor` и обрабатывать обнаружение циклических ссылок.
```csharp
public class CircularMonitor : AbstractCalculationMonitor
{
    public ArrayList circulars = new ArrayList();
    public ArrayList Circulars { get { return circulars; } }
    public override bool OnCircular(IEnumerator circularCellsData)
    {
        CalculationCell cc = null;
        ArrayList cur = new ArrayList();
        while (circularCellsData.MoveNext())
        {
            cc = (CalculationCell)circularCellsData.Current;
            cur.Add(cc.Worksheet.Name + "!" + CellsHelper.CellIndexToName(cc.CellRow, cc.CellColumn));
        }
        circulars.Add(cur);
        return true;
    }
}
```
Этот класс фиксирует сведения о каждой найденной циклической ссылке, включая имя рабочего листа и индекс ячейки.
## Заключение
Обнаружение циклических ссылок в Excel с помощью Aspose.Cells для .NET — простой процесс, если разбить его на управляемые шаги. Следуя этому руководству, вы сможете легко определять и обрабатывать циклические ссылки в своих электронных таблицах, гарантируя точность и надежность своих расчетов. Независимо от того, являетесь ли вы опытным разработчиком или только начинаете, Aspose.Cells предоставляет мощные инструменты для улучшения ваших возможностей по работе с Excel. 
## Часто задаваемые вопросы
### Что такое циклическая ссылка в Excel?
Циклическая ссылка возникает, когда формула ссылается на свою собственную ячейку, вызывая бесконечный цикл в вычислениях.
### Как можно программно обнаружить циклические ссылки?
Вы можете использовать библиотеку Aspose.Cells в .NET для программного обнаружения циклических ссылок, реализовав пользовательский монитор вычислений.
### Каковы предварительные условия для использования Aspose.Cells?
Вам необходимо установить Visual Studio, .NET Framework и библиотеку Aspose.Cells.
### Могу ли я использовать Aspose.Cells бесплатно?
Да, Aspose.Cells предлагает бесплатную пробную версию, которую вы можете использовать для изучения ее возможностей.
### Где я могу найти более подробную информацию об Aspose.Cells?
 Вы можете посетить[Документация Aspose.Cells](https://reference.aspose.com/cells/net/) для получения подробной информации и примеров.
{{< /blocks/products/pf/tutorial-page-section >}}

{{< /blocks/products/pf/main-container >}}
{{< /blocks/products/pf/main-wrap-class >}}

{{< blocks/products/products-backtop-button >}}
