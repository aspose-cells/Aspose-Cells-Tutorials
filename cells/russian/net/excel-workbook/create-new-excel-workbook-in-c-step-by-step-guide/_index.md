---
category: general
date: 2026-02-15
description: Создайте новую книгу Excel и изучите, как использовать функцию EXPAND,
  расширять последовательность и вычислять котангенс. Также посмотрите, как сохранить
  книгу в файл.
draft: false
keywords:
- create new excel workbook
- save workbook to file
- how to use expand
- how to expand sequence
- how to calculate cotangent
language: ru
og_description: Создайте новую книгу Excel с помощью C#. Узнайте, как использовать
  функцию EXPAND, расширять последовательность, вычислять котангенс и сохранять книгу
  в файл.
og_title: Создание новой книги Excel в C# — Полное руководство по программированию
tags:
- C#
- Aspose.Cells
- Excel automation
title: Создание новой книги Excel в C# — пошаговое руководство
url: /ru/net/excel-workbook/create-new-excel-workbook-in-c-step-by-step-guide/
---

{{< blocks/products/pf/main-wrap-class >}}
{{< blocks/products/pf/main-container >}}
{{< blocks/products/pf/tutorial-page-section >}}

# Создание новой книги Excel в C# – Полное руководство по программированию

Когда‑нибудь вам нужно было **create new Excel workbook** из кода, но вы не знали, с чего начать? Вы не одиноки; многие разработчики сталкиваются с этим, когда автоматизируют отчёты или строят конвейеры данных. В этом руководстве мы покажем, как именно создать новую книгу Excel, записать пару интересных формул и затем **save workbook to file** для последующего просмотра.  

Мы также подробно разберём функцию `EXPAND`, продемонстрируем **how to use expand**, чтобы превратить небольшую последовательность в большой блок, объясним **how to expand sequence** на практике и, наконец, покажем **how to calculate cotangent** непосредственно в Excel. К концу вы получите исполняемую программу на C#, которую можно добавить в любой проект .NET.

## Что понадобится

- **Aspose.Cells for .NET** (бесплатная пробная версия или лицензия) – библиотека, позволяющая работать с Excel без установленного Office.  
- **.NET 6+** (или .NET Framework 4.6+).  
- Небольшая IDE, например Visual Studio 2022, VS Code или Rider.  

Дополнительные пакеты NuGet не требуются, кроме `Aspose.Cells`. Если у вас его ещё нет, выполните:

```bash
dotnet add package Aspose.Cells
```

Вот и всё — ничего больше настраивать не требуется.

## Шаг 1: Создание новой книги Excel

Первое, что мы делаем, — создаём объект `Workbook`. Считайте его пустым холстом, на котором будут располагаться все листы, ячейки и формулы.

```csharp
using Aspose.Cells;

class Program
{
    static void Main()
    {
        // Step 1: Create a new workbook and get the first worksheet
        Workbook workbook = new Workbook();               // creates an empty .xlsx in memory
        Worksheet worksheet = workbook.Worksheets[0];    // default sheet is named "Sheet1"
```

> **Почему это важно:** Создание книги в памяти означает, что диск не задействуется, пока вы явно не решите **save workbook to file**. Это ускоряет операцию и позволяет последовательно вносить изменения без накладных расходов ввода‑вывода.

## Шаг 2: Как использовать EXPAND для расширения последовательности

`EXPAND` — более новая функция Excel, которая берёт небольшой массив и растягивает его до заданного размера. В нашем примере мы начинаем с трёхстрочной вертикальной последовательности и превращаем её в блок 5 × 5.

```csharp
        // Step 2: Write a formula that expands a 3‑row sequence into a 5×5 block
        // The formula lives in A1 and will spill over to E5
        worksheet.Cells["A1"].Formula = "=EXPAND(SEQUENCE(3),5,5)";
```

> **Объяснение:** `SEQUENCE(3)` создаёт `{1;2;3}` (вертикальный массив). `EXPAND(...,5,5)` указывает Excel повторять этот массив, пока он не заполнит прямоугольник 5 строк на 5 столбцов, начиная с A1. В результате получаем матрицу, где каждый столбец повторяет исходные три числа, а последние две строки пусты, потому что исходный массив содержит только три строки.

### Ожидаемый результат

| A | B | C | D | E |
|---|---|---|---|---|
| 1 | 1 | 1 | 1 | 1 |
| 2 | 2 | 2 | 2 | 2 |
| 3 | 3 | 3 | 3 | 3 |
|   |   |   |   |   |
|   |   |   |   |   |

Вы увидите тот же шаблон, распространяющийся по диапазону, когда откроете книгу в Excel.

## Шаг 3: Как вычислить котангенс в Excel

Большинство знакомы с `SIN`, `COS` и `TAN`, но `COT` — удобный ярлык для обратного тангенса. Вот как получить котангенс 45° (равный 1), используя радианы.

```csharp
        // Step 3: Write a formula that returns the cotangent of 45° (π/4 radians)
        worksheet.Cells["B1"].Formula = "=COT(PI()/4)";
```

> **Зачем использовать COT?** Прямой вызов `COT` избавляет от дополнительного деления, которое потребовалось бы при `1/TAN(...)`, делая формулу понятнее и немного быстрее для больших листов.

## Шаг 4: Вычисление всех формул

Aspose.Cells не вычисляет формулы автоматически, если не указать явно. Метод `CalculateFormula` принудительно выполняет полное вычисление, чтобы полученные значения сохранялись в ячейках.

```csharp
        // Step 4: Evaluate all formulas so the results are stored in the cells
        workbook.CalculateFormula();
```

> **Совет:** Если у вас много ресурсоёмких формул, можно передать объект `CalculationOptions` для тонкой настройки производительности (например, включить многопоточность).

## Шаг 5: Сохранение книги в файл

Теперь, когда всё готово, мы наконец **save workbook to file**. Выберите папку, в которую у вас есть права записи, и задайте файлу осмысленное имя.

```csharp
        // Step 5: Save the workbook to a file for inspection
        string outputPath = @"C:\Temp\output.xlsx";
        workbook.Save(outputPath);
        System.Console.WriteLine($"Workbook saved to {outputPath}");
    }
}
```

> **Что происходит на диске?** Вызов `Save` записывает полностью сформированный пакет `.xlsx`, включающий развернутый массив из `EXPAND` и вычисленное значение котангенса. Откройте файл в Excel, и вы увидите блок 5 × 5, начинающийся с A1, и число `1` в B1.

![Вывод Excel, показывающий расширенную последовательность и значение котангенса](excel-output.png "пример вывода создания новой книги Excel")

*Image alt text: пример вывода создания новой книги Excel*

### Быстрая проверка

1. Откройте `output.xlsx`.  
2. Убедитесь, что ячейки **A1:E5** содержат повторяющийся шаблон 1‑2‑3.  
3. Посмотрите на **B1** — там должно отображаться `1`.  

Если всё совпадает, поздравляем — вы успешно автоматизировали работу с Excel!

## Как расширять последовательность в других сценариях

Хотя в примере выше используется статическая `SEQUENCE(3)`, её легко заменить динамическим диапазоном или другой формулой:

```csharp
// Expand a dynamic range from D1:D10 to a 4×4 block
worksheet.Cells["F1"].Formula = "=EXPAND(D1:D10,4,4)";
```

**Когда использовать?**  
- Генерация таблиц‑заполнителей для шаблонов.  
- Быстрое копирование строки заголовка по множеству столбцов.  
- Создание сеток тепловой карты без ручного копирования‑вставки.

## Распространённые подводные камни и как их избежать

| Проблема | Почему происходит | Решение |
|---------|-------------------|--------|
| `#VALUE!` after `EXPAND` | Исходный массив не является корректным диапазоном (например, содержит ошибки) | Очистите исходные данные или оберните их в `IFERROR`. |
| Cotangent returns `#DIV/0!` for 0° | `COT(0)` математически бесконен | Защитите формулу с помощью `IF(PI()/4=0,0,COT(...))`. |
| Workbook not saved | Путь недействителен или отсутствуют права записи | Используйте `Path.GetFullPath` и проверьте существование папки. |
| Formulas not calculated | `CalculateFormula` пропущен | Всегда вызывайте его перед `Save`. |

## Бонус: Добавление стилей (необязательно)

Если вы хотите, чтобы вывод выглядел лучше, можете применить простой стиль после вычислений:

```csharp
        // Apply a light gray background to the expanded block
        Style style = workbook.CreateStyle();
        style.Pattern = BackgroundType.Solid;
        style.ForegroundColor = System.Drawing.Color.LightGray;
        StyleFlag flag = new StyleFlag { CellShading = true };
        worksheet.Cells.CreateRange("A1:E5").ApplyStyle(style, flag);
```

Этот фрагмент необязателен, но он показывает, как можно объединить логику **create new Excel workbook** с форматированием за один проход.

## Итоги

Мы прошли весь процесс:

1. **Create new Excel workbook** с Aspose.Cells.  
2. Использовать **how to use expand**, чтобы превратить небольшую `SEQUENCE` в матрицу 5 × 5.  
3. Показать **how to calculate cotangent** непосредственно в ячейке.  
4. Принудительно вычислить с помощью `CalculateFormula`.  
5. **Save workbook to file** и проверить результат.

Всё это автономно, работает на любой современной среде выполнения .NET и требует только один пакет NuGet.

## Что дальше?

- **Dynamic data sources:** Получать данные из базы и передавать их в `EXPAND`.  
- **Multiple worksheets:** Перебрать коллекцию листов для создания полного отчётного книги.  
- **Advanced formulas:** Исследовать `LET`, `LAMBDA` или массивную условную логику для более умных таблиц.  

Не стесняйтесь экспериментировать — меняйте аргумент `SEQUENCE`, пробуйте разные углы для `COT` или добавляйте построение графиков. Возможности безграничны, когда вы можете **create new Excel workbook** программно.

---

*Счастливого кодинга! Если столкнётесь с проблемами, оставьте комментарий ниже или напишите мне в Twitter @YourHandle. Буду рад помочь.*

{{< /blocks/products/pf/tutorial-page-section >}}
{{< /blocks/products/pf/main-container >}}
{{< /blocks/products/pf/main-wrap-class >}}
{{< blocks/products/products-backtop-button >}}