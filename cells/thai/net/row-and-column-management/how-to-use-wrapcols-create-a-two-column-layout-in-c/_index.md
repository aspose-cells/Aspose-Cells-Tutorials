---
category: general
date: 2026-02-15
description: วิธีใช้ WRAPCOLS เพื่อสร้างเลย์เอาต์สองคอลัมน์, เพิ่มสูตร และสร้างอาเรย์ลำดับในแผ่นงาน
  C# – คู่มือแบบทีละขั้นตอน
draft: false
keywords:
- how to use wrapcols
- create two column layout
- how to add formula
- how to create columns
- generate sequence array
language: th
og_description: วิธีใช้ WRAPCOLS เพื่อสร้างเลย์เอาต์สองคอลัมน์, เพิ่มสูตรและสร้างอาเรย์ลำดับในแผ่นงาน
  C# – คู่มือฉบับสมบูรณ์
og_title: 'วิธีใช้ WRAPCOLS: การจัดวางสองคอลัมน์ใน C#'
tags:
- CSharp
- ExcelAutomation
- WorksheetFormula
title: 'วิธีใช้ WRAPCOLS: สร้างเลย์เอาต์สองคอลัมน์ใน C#'
url: /th/net/row-and-column-management/how-to-use-wrapcols-create-a-two-column-layout-in-c/
---

{{< blocks/products/pf/main-wrap-class >}}
{{< blocks/products/pf/main-container >}}
{{< blocks/products/pf/tutorial-page-section >}}

# วิธีใช้ WRAPCOLS: สร้างเลเอาต์สองคอลัมน์ใน C#

เคยสงสัย **วิธีใช้ WRAPCOLS** เมื่อคุณต้องการมุมมองสองคอลัมน์อย่างรวดเร็วในแผ่นงานสไตล์ Excel หรือไม่? คุณไม่ได้อยู่คนเดียว นักพัฒนาหลายคนเจออุปสรรคเมื่อต้องแบ่งรายการที่สร้างขึ้นเป็นคอลัมน์ที่เรียบร้อยโดยไม่ต้องเขียนลูปสำหรับแต่ละเซลล์ ข่าวดีคือ? ด้วยฟังก์ชัน `WRAPCOLS` คุณสามารถใส่สูตรเดียวลงใน `A1` แล้วให้ Excel (หรือเอนจินที่เข้ากันได้) ทำงานหนักให้คุณ

ในบทแนะนำนี้เราจะพาคุณผ่าน **วิธีเพิ่มสูตร** ที่สร้าง **เลเอาต์สองคอลัมน์** แสดงให้คุณ **วิธีสร้างคอลัมน์** อย่างไดนามิก และแม้กระทั่ง **สร้างอาเรย์ลำดับ** บนพื้นฐานแบบเรียลไทม์ เมื่อเสร็จสิ้นคุณจะได้สแนปช็อต C# ที่สามารถรันได้เต็มรูปแบบ ซึ่งคุณสามารถวางลงในโปรเจกต์ของคุณ รัน แล้วเห็นบล็อกสองคอลัมน์ที่เรียบร้อยปรากฏขึ้นทันที

## สิ่งที่คุณจะได้เรียนรู้

- จุดประสงค์ของ `WRAPCOLS` และทำไมมันจึงเป็นทางเลือกที่ดีกว่าการวนลูปด้วยตนเอง  
- วิธี **เพิ่มสูตร** ลงในเซลล์ของแผ่นงานโดยใช้ C#  
- วิธีสร้างอาเรย์ลำดับด้วย `SEQUENCE` แล้วส่งเข้า `WRAPCOLS`  
- เคล็ดลับการคำนวณแผ่นงานใหม่เพื่อให้สูตรประเมินผลทันที  
- การจัดการกรณีขอบ (เช่น แผ่นงานว่าง, จำนวนคอลัมน์ที่กำหนดเอง)

ไม่ต้องใช้ไลบรารีภายนอกนอกจากแพ็กเกจการประมวลผล Excel มาตรฐาน – เราจะใช้ **ClosedXML** เนื่องจาก API ที่ตรงไปตรงมา แต่แนวคิดเหล่านี้สามารถนำไปใช้กับ EPPlus, SpreadsheetGear หรือแม้แต่ Google Sheets ผ่าน API ของมันได้

---

## ข้อกำหนดเบื้องต้น

- .NET 6.0 หรือใหม่กว่า (โค้ดสามารถคอมไพล์บน .NET Core และ .NET Framework)  
- อ้างอิงถึง **ClosedXML** (`dotnet add package ClosedXML`)  
- ความรู้พื้นฐานของ C# – คุณควรคุ้นเคยกับคำสั่ง `using` และการกำหนดค่าออบเจกต์  

หากคุณมีเวิร์กบุ๊กเปิดอยู่แล้ว คุณสามารถข้ามขั้นตอนการสร้างไฟล์และไปที่ส่วนสูตรได้ทันที

---

## ขั้นตอนที่ 1: ตั้งค่า Worksheet (วิธีสร้างคอลัมน์)

ก่อนอื่นเราต้องมีออบเจกต์ `Worksheet` เพื่อทำงานด้วย ใน ClosedXML คุณจะได้มาจาก `XLWorkbook` โค้ดด้านล่างสร้างเวิร์กบุ๊กใหม่, เพิ่มชีทชื่อ *Demo*, และเก็บอ้างอิงไว้ในตัวแปร `worksheet` เพื่อความชัดเจน

```csharp
using ClosedXML.Excel;

namespace WrapColsDemo
{
    class Program
    {
        static void Main()
        {
            // Create a fresh workbook and add a worksheet named "Demo"
            using var workbook = new XLWorkbook();
            var ws = workbook.Worksheets.Add("Demo");

            // Rename for clarity – this is the worksheet we’ll manipulate
            var worksheet = ws;   // <-- same object, just a clearer name

            // --------------------------------------------------------------
            // Next step: write the WRAPCOLS formula
            // --------------------------------------------------------------
```

> **ทำไมต้องเปลี่ยนชื่อ?**  
> การเก็บชื่อตัวแปรให้สั้น (`worksheet`) ทำให้โค้ดต่อ ๆ ไปอ่านง่ายขึ้น โดยเฉพาะเมื่อคุณเชื่อมต่อหลายขั้นตอน มันยังสอดคล้องกับสไตล์การตั้งชื่อที่พบในเอกสารส่วนใหญ่ ลดภาระการจดจำ

---

## ขั้นตอนที่ 2: เขียนสูตร (วิธีเพิ่มสูตร + สร้างอาเรย์ลำดับ)

ต่อไปเป็นบรรทัดวิเศษ เราจะใส่สูตรในเซลล์ **A1** ซึ่งทำสองอย่างพร้อมกัน

1. **สร้างอาเรย์ลำดับ** ของหกตัวเลข (`SEQUENCE(6)` → 1,2,3,4,5,6)  
2. **ห่อจำนวนเหล่านั้นเป็นสองคอลัมน์** (`WRAPCOLS(..., 2)`)

```csharp
            // Write the WRAPCOLS formula into A1
            worksheet.Cell("A1").FormulaA1 = "=WRAPCOLS(SEQUENCE(6), 2)";

            // --------------------------------------------------------------
            // Finally, force the engine to evaluate the formula
            // --------------------------------------------------------------
```

> **เกิดอะไรขึ้น?**  
> `SEQUENCE(6)` สร้างอาเรย์แนวตั้ง `{1;2;3;4;5;6}` `WRAPCOLS` จะรับอาเรย์นั้นและ “ห่อ” เป็นจำนวนคอลัมน์ที่กำหนด – ในที่นี้คือ **2** ผลลัพธ์คือบล็อก 3‑แถว × 2‑คอลัมน์ที่มีลักษณะดังนี้  

| A | B |
|---|---|
| 1 | 4 |
| 2 | 5 |
| 3 | 6 |

หากคุณเปลี่ยนอาร์กิวเมนต์ที่สองเป็น **3** คุณจะได้เลเอาต์สามคอลัมน์แทน นี่คือหัวใจของ **วิธีสร้างคอลัมน์** อย่างอัตโนมัติโดยไม่ต้องวนลูปด้วยตนเอง

---

## ขั้นตอนที่ 3: คำนวณ Worksheet ใหม่ (เพื่อให้สูตรประเมินผล)

ClosedXML จะไม่ประเมินสูตรโดยอัตโนมัติเมื่อคุณเขียนลงไป คุณต้องเรียก `Calculate()` บนเวิร์กบุ๊ก (หรือบนแผ่นงานเฉพาะ) เพื่อบังคับให้ประเมินผล

```csharp
            // Recalculate so the formula is evaluated immediately
            worksheet.Calculate();

            // Optional: save the workbook to inspect the result
            workbook.SaveAs("WrapColsDemo.xlsx");
        }
    }
}
```

> **เคล็ดลับมือโปร:** หากคุณทำงานกับเวิร์กบุ๊กขนาดใหญ่ ให้เรียก `Calculate()` เฉพาะบนชีทที่มีการเปลี่ยนแปลงจริงเท่านั้น จะช่วยประหยัดหน่วยความจำและเร่งความเร็วการประมวลผล  

เมื่อคุณเปิด `WrapColsDemo.xlsx` คุณจะเห็นเลเอาต์สองคอลัมน์ที่เติมเต็มอย่างเรียบร้อยใน **A1:B3** ไม่ต้องเขียนโค้ดเพิ่มเติมเพื่อวนลูปแถวหรือคอลัมน์ – `WRAPCOLS` จัดการทุกอย่างให้เอง

---

## ขั้นตอนที่ 4: ตรวจสอบผลลัพธ์ (สิ่งที่คาดหวัง)

หลังจากรันโปรแกรมแล้ว เปิดไฟล์ที่สร้างขึ้น คุณควรเห็น:

| A | B |
|---|---|
| 1 | 4 |
| 2 | 5 |
| 3 | 6 |

หากตัวเลขปรากฏเป็นแนวตั้ง (เช่น ทั้งหมดอยู่ในคอลัมน์ A) ให้ตรวจสอบว่าคุณเรียก `worksheet.Calculate()` **หลัง** ตั้งสูตรบางเอนจินอาจต้องเรียก `workbook.Calculate()` ด้วย; โค้ดตัวอย่างข้างบนทำงานกับ evaluator ภายในของ ClosedXML

---

## การเปลี่ยนแปลงทั่วไปและกรณีขอบ

### เปลี่ยนจำนวนคอลัมน์

เพื่อ **สร้างเลเอาต์สองคอลัมน์** ด้วยจำนวนแถวที่ต่างกัน เพียงปรับขนาดของ `SEQUENCE` หรืออาร์กิวเมนต์ที่สองของ `WRAPCOLS`

```csharp
worksheet.Cell("A1").FormulaA1 = "=WRAPCOLS(SEQUENCE(12), 3)";
```

โค้ดนี้สร้างบล็อก 4‑แถว × 3‑คอลัมน์ (12 ตัวเลขที่แบ่งเป็นสามคอลัมน์)

### ใช้จำนวนคอลัมน์แบบไดนามิก

หากจำนวนคอลัมน์มาจากตัวแปร ให้ฝังค่าโดยใช้ string interpolation

```csharp
int colCount = 4;
worksheet.Cell("A1").FormulaA1 = $"=WRAPCOLS(SEQUENCE(8), {colCount})";
```

ตอนนี้คุณมี **วิธีเพิ่มสูตร** ที่ปรับตัวตามเวลารันได้แล้ว

### Worksheet ว่าง

หากแผ่นงานว่าง `Calculate()` ยังทำงาน – สูตรจะเติมเซลล์ตั้งแต่ A1 อย่างไรก็ตาม หากคุณลบแถว/คอลัมน์ที่ตัดกับช่วงผลลัพธ์ภายหลัง คุณอาจเจอข้อผิดพลาด `#REF!` เพื่อหลีกเลี่ยง ให้ล้างช่วงเป้าหมายก่อน

```csharp
worksheet.Range("A1:Z100").Clear(); // wipes any leftovers
```

### ความเข้ากันได้

`WRAPCOLS` และ `SEQUENCE` เป็นส่วนหนึ่งของฟังก์ชัน **Dynamic Array** ของ Excel ที่เปิดตัวใน Office 365 หากคุณทำงานกับเวอร์ชัน Excel เก่า ฟังก์ชันเหล่านี้จะไม่มีอยู่และคุณต้องใช้ลูปแบบมือ `ClosedXML` evaluator จำลองพฤติกรรมล่าสุดของ Excel จึงปลอดภัยสำหรับสภาพแวดล้อมสมัยใหม่

---

## ตัวอย่างทำงานเต็มรูปแบบ (พร้อมคัดลอก‑วาง)

```csharp
using ClosedXML.Excel;

namespace WrapColsDemo
{
    class Program
    {
        static void Main()
        {
            // 1️⃣ Create workbook & worksheet
            using var workbook = new XLWorkbook();
            var ws = workbook.Worksheets.Add("Demo");
            var worksheet = ws;   // clearer name

            // 2️⃣ Write WRAPCOLS formula that generates a sequence array
            worksheet.Cell("A1").FormulaA1 = "=WRAPCOLS(SEQUENCE(6), 2)";

            // 3️⃣ Force calculation so the formula resolves immediately
            worksheet.Calculate();

            // 4️⃣ Save the file (optional, but handy for verification)
            workbook.SaveAs("WrapColsDemo.xlsx");
        }
    }
}
```

**ผลลัพธ์ที่คาดหวัง:** การเปิด *WrapColsDemo.xlsx* จะเห็นเลเอาต์สองคอลัมน์ที่เรียบร้อยพร้อมตัวเลข 1‑6 จัดเรียงตามที่อธิบายไว้ข้างต้น

---

## สรุป

เราได้ครอบคลุม **วิธีใช้ WRAPCOLS** เพื่อ **สร้างเลเอาต์สองคอลัมน์**, แสดง **วิธีเพิ่มสูตร** อย่างโปรแกรมเมติก, และเห็นว่า `SEQUENCE` ทำให้คุณ **สร้างอาเรย์ลำดับ** ได้โดยไม่ต้องวนลูป ด้วยการใช้ฟังก์ชันอาร์เรย์ไดนามิกของ Excel จาก C# คุณสามารถทำให้โค้ดของคุณกระชับ อ่านง่าย และดูแลรักษาได้ง่ายขึ้น

ต่อไปคุณอาจอยากสำรวจ:

- **สร้างจำนวนแถวแบบไดนามิก** ด้วย `ROWS` หรือ `COUNTA`  
- **จัดรูปแบบผลลัพธ์** (เส้นขอบ, ฟอร์แมตตัวเลข) ด้วย API การสไตลิ่งของ ClosedXML  
- **ส่งออกเป็น CSV** หลังจากสร้างเลเอาต์แล้ว เพื่อการประมวลผลต่อเนื่อง

ลองทำดู ปรับจำนวนคอลัมน์ แล้วคุณจะเห็นว่าการสร้างสเปรดชีตที่ซับซ้อนสามารถทำได้เร็วแค่ไหน โค้ดดิ้งสนุก! 

{{< /blocks/products/pf/tutorial-page-section >}}
{{< /blocks/products/pf/main-container >}}
{{< /blocks/products/pf/main-wrap-class >}}
{{< blocks/products/products-backtop-button >}}